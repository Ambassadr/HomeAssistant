# @Author: Will Scott <willscottuk>
# @Date:   12/06/2017 20:34
# @Project: Ambassadr Home Automation
# @Last modified by:   willscott
# @Last modified time: 03/02/2018 18:38

# This package deals with what I hope will become whole home audio!
# Lots more work needed here! TODO: Almost everything!

homeassistant:
  customize:
    # media_player.snapcast_client_676c68d1dd024661b816a27cea8a6b4c:
    #   friendly_name: Vox One

media_player:

  # Squeezebox and snapcast removed, sonos in!

  - platform: spotify
    client_id: !secret spot_id
    client_secret: !secret spot_secret

  - platform: sonos

automation:

  - alias: Spotify Card Visible
    trigger:
      platform: template
      value_template: "{{ not is_state('media_player.spotify', 'paused') }}"
    action:
      service: group.set_visibility
      entity_id: group.spotify_card
      data:
        visible: true

  - alias: Spotify Card Hidden
    trigger:
      - platform: homeassistant
        event: start
      - platform: state
        entity_id: media_player.spotify
        to: 'paused'
        for:
          minutes: 5
      - platform: state
        entity_id: media_player.spotify
        to: 'idle'
        for:
          minutes: 3
      - platform: state
        entity_id: media_player.spotify
        to: 'off'
    action:
      service: group.set_visibility
      entity_id: group.spotify_card
      data:
        visible: false

  - alias: Living Room Sonos Visible
    trigger:
      platform: template
      value_template: "{{ not is_state('media_player.living_room_one', 'paused') }}"
    action:
      service: group.set_visibility
      entity_id: group.sonos_livingroom
      data:
        visible: true

  - alias: Spotify Card Hidden
    trigger:
      - platform: homeassistant
        event: start
      - platform: state
        entity_id: media_player.living_room_one
        to: 'paused'
        for:
          minutes: 5
      - platform: state
        entity_id: media_player.living_room_one
        to: 'idle'
        for:
          minutes: 3
      - platform: state
        entity_id: media_player.living_room_one
        to: 'off'
    action:
      service: group.set_visibility
      entity_id: group.sonos_livingroom
      data:
        visible: false

  - alias: Bedroom Sonos Visible
    trigger:
      platform: template
      value_template: "{{ not is_state('media_player.bedroom_one', 'paused') }}"
    action:
      service: group.set_visibility
      entity_id: group.sonos_bedroom
      data:
        visible: true

  - alias: Spotify Card Hidden
    trigger:
      - platform: homeassistant
        event: start
      - platform: state
        entity_id: media_player.bedroom_one
        to: 'paused'
        for:
          minutes: 5
      - platform: state
        entity_id: media_player.bedroom_one
        to: 'idle'
        for:
          minutes: 3
      - platform: state
        entity_id: media_player.bedroom_one
        to: 'off'
    action:
      service: group.set_visibility
      entity_id: group.sonos_bedroom
      data:
        visible: false

group:
  spotify_card: # TODO: Improve this!
    entities:
      - media_player.spotify
  sonos_livingroom:
    entities:
      - media_player.living_room_one
  sonos_bedroom:
    entities:
      - media_player.bedroom_one
